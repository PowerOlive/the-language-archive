#!/bin/sh
cd $(dirname $0)
r="$PWD"

doc="$r"/DOC
doc_html="$r"/docs
doc_markdown="$doc"
doc_tex="$doc"
rm -fr "$doc"
mkdir "$doc" || exit

doc_html_cname="$(cat $doc_html/CNAME)"
rm -fr "$doc_html"
mkdir "$doc_html" || exit
echo "$doc_html_cname" > "$doc_html"/CNAME

doc_scrbl() {
n="$1"
f="$2"
scribble --dest "$doc_html" --html --dest-name "$n".html "$f" &
scribble --dest "$doc_markdown" --markdown --dest-name "$n".md "$f" &
scribble --dest "$doc_tex" --latex --dest-name "$n".tex "$f" &
}
md() {
cat "$doc_markdown"/"$1".md
}
html() {
cat "$doc_html"/"$1".html
}
tex() {
cat "$doc_tex"/"$1".tex
}

doc_scrbl lambda "$r"/化/述.scrbl

wait

cat > "$r"/README.md <<EOF
語
==
    The Language: the best programming language
    Copyright (C) 2014-2018  Zaoqi <zaomir@outlook.com>

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published
    by the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

化
--
[HTML](DOC/html/lambda.html)
$(md lambda)
EOF

cp "$doc_html"/lambda.html "$doc_html"/index.html
